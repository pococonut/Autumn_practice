
# CompetitiveBot

## Описание проекта

CompetitiveBot - это телеграм бот, реализующий возможности соревновательной системы по программированию на основе сервиса DOMjudge. CompetitiveBot предоставляет список задач по программированию трех уровней сложности. Решения принимаются на нескольких доступных языках программирования, благодаря чему вы можете проверить свои навыки в каждом из них. Также бот выводит рейтинговую таблицу, где вы можете увидеть свое место среди других пользователей. Это поможет вам отслеживать свой прогресс и стремиться к новым результатам.


CompetitiveBot объединяет в себе интерфейс в виде телеграм-бота и серверную часть: веб-интерфейс для работы с данными (domserver), сервер судьи, необходимый для оценки и тестирования решений пользователей (judgehost) и базу данных (mariadb)

При напиcании сервиса были использованы python3, Ubuntu 20.04.

## Руководство по установке и настройке сервиса CompetitiveBot

### Установка необходимых контейнеров и исходного кода проекта.

1. Установка docker.
\
Руководство по установке docker вы можете найти на [странице официальной документации](https://docs.docker.com/engine/install/ubuntu/).

2. Клонирование проекта CompetitiveBot из репозитория.

```
git clone https://github.com/pococonut/CompetitiveBot.git
```

3. Создание файла .env 
\
Для правильной работы программы и ее взаимодействия с другими сервисами, необходимо в корневой папке проекта создать файл .env и указать в нем конфигурационные данные для приложения. 
\
\
Такие параметры как ADMIN_PASSWORD для пользователя admin и JUDGEDAEMON_PASSWORD для пользователя judgehost будут доступны после сборки контейнера domserver, на этом шаге оставьте их пустыми.

Пример файла .env:

```
API=

ADMIN_USERNAME=admin
ADMIN_PASSWORD=

DAEMON_ID=0
JUDGEDAEMON_PASSWORD=

MYSQL_ROOT_PASSWORD=domjudge
MYSQL_USER=domjudge
MYSQL_PASSWORD=djpw
MYSQL_DATABASE=domjudge

MYSQL_ROOT_PASSWORD=domjudge
MYSQL_USER=domjudge
MYSQL_PASSWORD=djpw
MYSQL_DATABASE=domjudge
MYSQL_HOST=mariadb
```

4. Запуск контейнеров dj-mariadb и dj-domserver.
\
В корневой папке проекта выполните команды:

```
docker-compose up -d dj-mariadb
docker-compose up dj-domserver
```

В консоль будут выведены пароли для пользователей admin и judgehost в формате:

```
cb-domserver       | Initial admin password is ...
cb-domserver       | 
cb-domserver       | Initial judgehost password is ...
```

Пароли необходимо сохранить, будьте внимательны.

5. Установка паролей.
\
Перейдите в файл .env и установите пароли для ADMIN_PASSWORD и JUDGEDAEMON_PASSWORD, которые были получены на предыдущем шаге.

6. Запуск контейнеров.
\
Далее выполните команду:

```
docker-compose up
```
\
После правильной установки, вам будет доступен веб-интерфейс DOMjudge по адресу http://localhost:12345.
\
\
Для входа будет необходимо указать имя и пароль пользователя admin.

![веб-интерфейс DOMjudge](images/снимок1.png)

### Заполнение базы данных сервиса.

Для корректной работы с CompetitiveBot, вам будет необходимо добавить данные в определенном формате.

1. Создание нового соревнования (Contests).
\
По умолчанию будет создано тестовое соревнование с тестовыми задачами. Для правильного отображения задач нужно либо удалить задачи в тестовом соревновании, либо создать новое соревнование. После создания соревнования в  него необходимо добавить задачи. Рассмотрим вариант создания нового соревнования.

Во вкладке Contests выберите Add new contest.

![Add new contest](images/снимок2.png)

Укажите параметры Shortname, Name, Start time, End time.

После добавления соревнования, его id будет равен 2, если вы не создавали  больше соревнований. CompetitiveBot использует id соревнования равным 2, если вы хотите использовать другое соревнование, укажите его id в файле commands/url_requests.py в параметре ```CONTEST_ID = "2"```

2. Создание задач.
\
Внимание! Для корректного отображения задачи в телеграм боте, необходимо создавать pdf-файл с описанием в определенном формате. Примеры готовых задач в формате docx и pdf, а так же входных-выходных тестовых данных в формате txt вы сможете найти [по этой ссылке](https://drive.google.com/drive/folders/13qsFPx9tzbNi--wTh5e02KzthBUE0ovq).
\
Телеграм бот принимает задачи трех уровней сложности - A, B, C
\
p_1_A.pdf - описание задачи, 1 - номер задачи, A - уровень задачи.
\
p_1_in_1.txt - первые входные тестовые данные для задачи p_1_A.
\
p_1_out_1.txt - первые выходные тестовые данные для задачи p_1_A.
\
p_1_in_2.txt - вторые входные тестовые данные для задачи p_1_A.
\
p_1_out_2.txt - вторые выходные тестовые данные для задачи p_1_A.
\
И так далее.
\
\
Для создания задачи перейдите во вкладку Problems и выберите Add new problem.

![Add new problem](images/снимок3.png)

Введите название задачи (Name)
\
Ограничение по времени на запуск и исполнение программы - решения задачи (Timelimit)
\
Описание задачи в виде pdf-файла (Problem text)
\
\
После добавления задачи, нужно добавить входные-выходные тестовые данные для задачи. 
\
В параметре Testcases нажмите details/ edit

![details/ edit](images/снимок4.png)

Добавьте тестовые данные в формате txt

![txt](images/снимок5.png)

3. Добавление задач в соревнование.

После того как вы создали соревнование и добавили несколько задач с тестовыми данными, необходимо добавить задачи в соревнование.
\
\
Перейдите во вкладку Contests и внизу страницы в All available contests нажмите на соревнование, в которое вы хотите добавить задачи.

![All available contests](images/снимок6.png)

Далее пролистайте вниз страницы и в Problems нажмите на кнопку Edit.

![Edit](images/снимок7.png)

Внизу страницы нажмите на знак "+" для добавления задачи в соревнование.

![Edit](images/снимок8.png)

В первой колонке выберите задачу которую хотите добавить. Далее необходимо указать короткое название задачи (Short name).
\
\
Внимание! В CompetitiveBot для разделения задач по уровню сложности исользуется короткое название задачи (Short name). Необходимо дать для задачи короткое название в форате:
\
p1_A - Легкая задача
\
p1_B - Средняя задача
\
p1_C - Сложная задача

где p - сокращение от problem, 1  - номер задачи в категории, A/B/C - уровень задачи.
\
\
Далее укажите баллы за задачу (Points)
\
\
После нажмите кнопку Save для добавления задачи в соревнование.

### Запуск телеграм бота

После правильной установки и настройки, сервис будет готов к использованию.


